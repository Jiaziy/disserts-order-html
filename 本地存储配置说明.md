# 甜点定制系统 - 本地存储配置说明

## 项目概述

本系统已从Supabase数据库切换为纯本地存储方案，确保项目在本地环境下独立运行，无需依赖外部数据库服务。

## 存储架构

### 核心存储文件

1. **`js/local-storage-manager.js`** - 主存储管理器
   - 统一管理所有本地存储操作
   - 提供简洁的API接口
   - 支持设计、订单、用户数据的存储

2. **`js/storage-utils.js`** - 兼容性存储工具
   - 保留原有存储接口的兼容性
   - 已移除Supabase依赖，转为纯本地存储

### 浏览器存储结构

```javascript
// localStorage 存储键名
{
    designs: 'sweetsDesigns',        // 设计数据主存储键
    user: 'currentUser',              // 当前用户信息
    lastDesign: 'lastDesignImage',    // 最近设计的图片
    lastDesignType: 'lastDesignType', // 最近设计的类型
    designResult: 'sweetsDesignResult', // 设计结果
    orders: 'orders',                 // 订单数据
    users: 'users',                   // 用户数据（本地注册）
    tutorial: 'hasVisitedTutorial'    // 教程访问标记
}
```

## 运行说明

### 运行方式

项目支持多种运行方式，无需任何外部依赖：

1. **直接运行HTML文件**
   ```bash
   # 在项目根目录直接打开HTML文件
   open index.html
   ```

2. **使用本地HTTP服务器**
   ```bash
   # Python 3
   python -m http.server 8000
   
   # Python 2
   python -m SimpleHTTPServer 8000
   
   # Node.js (需要安装http-server)
   npx http-server
   ```

3. **使用VSCode Live Server扩展**
   - 安装Live Server扩展
   - 右键点击HTML文件 → "Open with Live Server"

### 文件结构说明

```
disserts-order-html/
├── index.html              # 主页面
├── sweets-designer.html    # 甜点设计器
├── customize.html          # 定制页面
├── admin-*.html           # 管理页面
├── js/
│   ├── local-storage-manager.js  # 主存储管理器
│   ├── storage-utils.js          # 兼容性存储工具
│   ├── sweets-designer.js        # 甜点设计器
│   └── design.js                 # 设计页面逻辑
├── css/                    # 样式文件
└── 本地存储配置说明.md      # 此文档
```

## 数据存储位置

### 1. 设计数据存储
- **存储位置**: `localStorage.sweetsDesigns`
- **数据结构**:
  ```javascript
  {
    id: '设计唯一标识',
    name: '设计名称',
    canvasData: 'Base64编码的图片数据',
    dessertType: '甜点类型',
    createTime: '创建时间',
    userId: '用户ID',
    status: '状态(saved/archived)'
  }
  ```

### 2. 订单数据存储
- **存储位置**: `localStorage.orders`
- **数据结构**:
  ```javascript
  {
    id: '订单唯一标识',
    productType: '产品类型',
    selectedStyle: '选择的样式',
    designImage: '设计图片',
    totalPrice: '总价格',
    customerInfo: '客户信息',
    status: '订单状态(pending/completed)',
    createTime: '创建时间'
  }
  ```

### 3. 用户数据存储
- **存储位置**: `localStorage.users`（本地注册用户）
- **当前用户**: `localStorage.currentUser`
- **数据结构**:
  ```javascript
  {
    id: '用户唯一标识',
    email: '邮箱',
    displayName: '显示名称',
    createTime: '注册时间'
  }
  ```

## 功能特性

### 1. 甜点设计
- 支持手绘、图片导入、文字设计
- 实时预览和编辑
- 设计历史记录管理

### 2. 订单管理
- 设计转换为订单
- 订单状态跟踪
- 订单历史查看

### 3. 用户系统
- 本地用户注册/登录
- 用户设计数据隔离
- 用户偏好设置

## 技术栈

- **前端**: HTML5 + CSS3 + JavaScript (ES6+)
- **存储**: 浏览器 localStorage
- **画布**: Canvas API
- **图片处理**: Base64编码

## 浏览器兼容性

- Chrome 60+
- Firefox 55+
- Safari 11+
- Edge 79+

## 数据持久化

### 自动备份
设计数据会自动保存到浏览器本地存储，即使关闭浏览器后重新打开也能恢复数据。

### 数据导出
用户可以通过"我的设计"页面导出设计数据。

### 数据清理
- 单页应用：数据在页面刷新后仍保留
- 浏览器缓存清理：清除浏览器缓存会删除所有数据
- 用户注销：仅清除当前用户会话数据

## 常见问题

### Q: 数据存储在哪里？
A: 所有数据都存储在浏览器的localStorage中，仅限当前浏览器环境。

### Q: 如何在不同设备间同步数据？
A: 本地存储版本不支持跨设备同步，如需同步请考虑使用网络存储方案。

### Q: 数据安全吗？
A: 数据仅存储在本地浏览器，相对安全，但建议定期备份重要设计。

### Q: 支持离线使用吗？
A: 是的，完全支持离线使用，所有功能在无网络环境下均可正常工作。

## 开发者说明

### 存储API使用

```javascript
// 添加设计
const savedDesign = window.StorageManager.addDesign(designData);

// 获取用户设计
const userDesigns = window.StorageManager.getUserDesigns(userId);

// 保存最近设计
window.StorageManager.saveLastDesign({image: canvasData, type: 'chocolate'});

// 添加订单
const savedOrder = window.StorageManager.addOrder(orderData);
```

### 数据迁移

系统会自动处理旧格式数据的迁移，确保向后兼容。

---

**注意**: 本系统为纯本地存储方案，所有数据仅存在于当前浏览器环境。如需数据持久化或跨设备同步，请考虑部署到支持数据库的服务器环境。