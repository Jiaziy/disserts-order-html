<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>甜点设计师 - 定制您的专属甜点</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="css/sweets-designer.css">
    <script>
        // 全局错误处理，捕获Vercel部署环境的脚本加载问题
        window.addEventListener('error', function(e) {
            console.error('全局错误捕获:', e.error);
            console.error('错误源:', e.filename || '未知文件');
            console.error('错误行号:', e.lineno);
            console.error('错误列号:', e.colno);
            
            // 可以在这里添加错误上报逻辑
        });
        
        // 确保DOM完全加载后初始化
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM内容已加载完成');
        });
        
        // 确保所有资源加载完成后再初始化
        window.addEventListener('load', function() {
            console.log('页面所有资源已加载完成，开始初始化设计器');
            
            // 检查必要的脚本是否已加载
            if (typeof SweetsDesigner !== 'undefined') {
                console.log('SweetsDesigner类已定义，开始初始化');
                try {
                    const designer = new SweetsDesigner();
                    window.sweetsDesigner = designer;
                    console.log('设计器初始化成功');
                } catch (error) {
                    console.error('设计器初始化失败:', error);
                    // 如果初始化失败，显示错误提示
                    showErrorNotification('设计器初始化失败，请刷新页面重试');
                }
            } else {
                console.error('SweetsDesigner类未定义，脚本可能未正确加载');
                showErrorNotification('脚本加载失败，请检查网络连接后刷新页面');
            }
        });
        
        // 显示错误通知的函数
        function showErrorNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff6b6b;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 10000;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                font-family: Arial, sans-serif;
                font-size: 14px;
            `;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            // 5秒后自动消失
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
    </script>
</head>
<body>
    <div class="designer-container">
        <!-- 顶部导航栏 -->
        <header class="designer-header">
            <div class="header-left">
                <h1><i class="fas fa-palette"></i> 甜点设计师</h1>
                <span class="subtitle">创造您的专属美味艺术</span>
            </div>
            <div class="header-actions">
                <button id="save-design-btn" class="btn btn-primary">
                    <i class="fas fa-save"></i> 保存设计
                </button>
                <button id="export-image-btn" class="btn btn-secondary">
                    <i class="fas fa-download"></i> 导出图片
                </button>
                <button id="design-complete-btn" class="btn btn-success">
                    <i class="fas fa-check"></i> 设计完成
                </button>
            </div>
        </header>

        <!-- 主要设计区域 -->
        <main class="designer-main">
            <!-- 左侧工具栏 -->
            <aside class="sidebar sidebar-left">
                <!-- 历史操作 -->
                <div class="tool-section">
                    <h3><i class="fas fa-history"></i> 操作历史</h3>
                    <div class="button-group">
                        <button id="undo-action-btn" class="btn btn-outline">
                            <i class="fas fa-undo"></i> 撤销
                        </button>
                        <button id="redo-action-btn" class="btn btn-outline">
                            <i class="fas fa-redo"></i> 重做
                        </button>
                    </div>
                </div>

                <!-- 绘画工具 -->
                <div class="tool-section">
                    <h3><i class="fas fa-paint-brush"></i> 绘画工具</h3>
                    <div class="button-group">
                        <button class="tool-btn active" data-tool="brush">
                            <i class="fas fa-brush"></i> 画笔
                        </button>
                        <button class="tool-btn" data-tool="eraser">
                            <i class="fas fa-eraser"></i> 橡皮擦
                        </button>
                    </div>
                </div>

                <!-- 画笔设置 -->
                <div class="tool-section">
                    <h3><i class="fas fa-sliders-h"></i> 画笔设置</h3>
                    <div class="control-group">
                        <label>画笔大小</label>
                        <input type="range" id="brush-size" min="1" max="50" value="5">
                        <span id="size-value">5px</span>
                    </div>
                    <div class="control-group">
                        <label>画笔颜色</label>
                        <input type="color" id="custom-color" value="#FF6B6B">
                    </div>
                </div>

                <!-- 模板选择 -->
                <div class="tool-section">
                    <h3><i class="fas fa-shapes"></i> 模板选择</h3>
                    <div class="template-grid">
                        <button class="template-btn" data-template="circle">
                            <i class="fas fa-circle"></i>
                            <span>圆形</span>
                        </button>
                        <button class="template-btn" data-template="square">
                            <i class="fas fa-square"></i>
                            <span>方形</span>
                        </button>
                        <button class="template-btn" data-template="heart">
                            <i class="fas fa-heart"></i>
                            <span>心形</span>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- 中央画布区域 -->
            <section class="canvas-area">
                <div class="canvas-container">
                    <canvas id="design-canvas"></canvas>
                </div>
                <div class="canvas-controls">
                    <button id="reset-view-btn" class="btn btn-outline">
                        <i class="fas fa-sync"></i> 重置视图
                    </button>
                    <button id="clear-canvas-action-btn" class="btn btn-outline">
                        <i class="fas fa-trash"></i> 清空画布
                    </button>
                </div>
            </section>

            <!-- 右侧属性面板 -->
            <aside class="sidebar sidebar-right">
                <!-- 设计信息 -->
                <div class="tool-section">
                    <h3><i class="fas fa-info-circle"></i> 设计信息</h3>
                    <div class="info-panel">
                        <div class="input-group">
                            <label>设计名称</label>
                            <input type="text" id="design-name" value="未命名设计" placeholder="输入设计名称">
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">画布尺寸</span>
                                <span class="stat-value">1024 × 768</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">元素数量</span>
                                <span class="stat-value">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 图片上传 -->
                <div class="tool-section">
                    <h3><i class="fas fa-image"></i> 图片上传</h3>
                    <div class="upload-area">
                        <label for="image-upload-input" class="upload-label">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>拖放图片或点击上传</span>
                            <input type="file" id="image-upload-input" accept="image/*">
                        </label>
                        <small>支持 JPG, PNG, GIF 格式</small>
                    </div>
                </div>

                <!-- 文字工具 -->
                <div class="tool-section">
                    <h3><i class="fas fa-font"></i> 文字工具</h3>
                    <div class="text-tools">
                        <input type="text" id="text-input" placeholder="输入文字...">
                        <div class="text-controls">
                            <select id="font-family">
                                <option value="Arial">Arial</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Microsoft YaHei">微软雅黑</option>
                            </select>
                            <select id="font-size">
                                <option value="16">16px</option>
                                <option value="20">20px</option>
                                <option value="24">24px</option>
                            </select>
                        </div>
                        <button id="add-text-btn" class="btn btn-primary">添加文字</button>
                    </div>
                </div>

                <!-- 实时预览 -->
                <div class="tool-section">
                    <h3><i class="fas fa-eye"></i> 预览</h3>
                    <div class="preview-container">
                        <canvas id="preview-canvas" width="200" height="200"></canvas>
                    </div>
                    <div class="preview-controls">
                        <button id="switch-3d-preview" class="btn btn-outline">
                            <i class="fas fa-cube"></i> 3D预览
                        </button>
                    </div>
                </div>
            </aside>
        </main>

        <!-- 底部状态栏 -->
        <footer class="designer-footer">
            <div class="status-info">
                <span id="current-tool">当前工具: 画笔</span>
                <span id="zoom-level">缩放: 100%</span>
                <span id="canvas-size">画布: 1024×768</span>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="js/local-storage-manager.js"></script>
    <script src="js/storage-utils.js"></script>
    <script src="js/navigation-manager.js"></script>
    <script src="js/sweets-designer.js"></script>
</body>
</html>